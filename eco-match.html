<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Eco Match - Waste Sorting Game</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    :root {
      --primary: #10b981;
      --secondary: #004d40;
      --accent: #a5d6a7;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Open Sans', sans-serif;
      background: linear-gradient(135deg, #ecfdf5, #d1fae5);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .game-container {
      background: white;
      border-radius: 15px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.1);
      padding: 30px;
      max-width: 800px;
      width: 100%;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
    }

    .header h1 {
      color: var(--secondary);
      margin-bottom: 10px;
      font-size: 2rem;
    }

    .header p {
      color: #666;
      margin-bottom: 15px;
    }

    .game-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin-bottom: 30px;
    }

    .stat {
      background: #f0fdf4;
      padding: 15px;
      border-radius: 10px;
      text-align: center;
      border: 2px solid var(--primary);
    }

    .stat-label {
      color: #666;
      font-size: 0.9rem;
      margin-bottom: 5px;
    }

    .stat-value {
      color: var(--primary);
      font-size: 1.8rem;
      font-weight: bold;
    }

    .game-board {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 30px;
    }

    .waste-item {
      background: #f9fafb;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      border: 2px solid #d1d5db;
      cursor: grab;
      user-select: none;
      transition: all 0.3s ease;
    }

    .waste-item:active {
      cursor: grabbing;
    }

    .waste-item:hover {
      transform: translateY(-5px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .waste-icon {
      font-size: 2.5rem;
      margin-bottom: 10px;
    }

    .waste-name {
      font-weight: 600;
      color: var(--secondary);
      margin-bottom: 5px;
    }

    .bins-section {
      margin-bottom: 30px;
    }

    .bins-title {
      color: var(--secondary);
      font-weight: 600;
      margin-bottom: 15px;
      text-align: center;
    }

    .bins-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
    }

    .bin {
      background: white;
      border: 3px dashed #d1d5db;
      border-radius: 10px;
      padding: 20px;
      text-align: center;
      min-height: 150px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .bin.green {
      border-color: #22c55e;
      background: #f0fdf4;
    }

    .bin.blue {
      border-color: #3b82f6;
      background: #f0f9ff;
    }

    .bin.yellow {
      border-color: #eab308;
      background: #fefce8;
    }

    .bin-icon {
      font-size: 2rem;
      margin-bottom: 10px;
    }

    .bin-label {
      font-weight: 600;
      color: var(--secondary);
      font-size: 0.9rem;
    }

    .bin-items {
      margin-top: 10px;
      font-size: 0.85rem;
      color: #666;
    }

    .buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 30px;
    }

    .btn {
      padding: 12px 30px;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-primary {
      background: linear-gradient(90deg, #34d399, var(--primary));
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(16, 185, 129, 0.3);
    }

    .btn-secondary {
      background: #e5e7eb;
      color: #374151;
    }

    .btn-secondary:hover {
      background: #d1d5db;
    }

    .result-modal {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 40px;
      border-radius: 15px;
      box-shadow: 0 12px 40px rgba(0,0,0,0.3);
      text-align: center;
      z-index: 1000;
      min-width: 300px;
    }

    .result-modal.show {
      display: block;
    }

    .result-score {
      font-size: 3rem;
      color: var(--primary);
      font-weight: bold;
      margin: 20px 0;
    }

    .result-message {
      color: #666;
      font-size: 1.1rem;
      margin-bottom: 20px;
    }

    .overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 999;
    }

    .overlay.show {
      display: block;
    }

    @media (max-width: 768px) {
      .game-board {
        grid-template-columns: 1fr;
      }

      .bins-grid {
        grid-template-columns: 1fr;
      }

      .game-stats {
        grid-template-columns: 1fr;
      }
    }
  </style>
  <script src="common.js"></script>
</head>
<body>
  <div class="game-container">
    <div class="header">
      <h1>‚ôªÔ∏è Eco Match</h1>
      <p>Drag waste items to the correct recycling bin!</p>
    </div>

    <div class="game-stats">
      <div class="stat">
        <div class="stat-label">Score</div>
        <div class="stat-value" id="score">0</div>
      </div>
      <div class="stat">
        <div class="stat-label">Correct</div>
        <div class="stat-value" id="correct">0</div>
      </div>
      <div class="stat">
        <div class="stat-label">Items Left</div>
        <div class="stat-value" id="itemsLeft">6</div>
      </div>
    </div>

    <div class="game-board" id="wasteBoard"></div>

    <div class="bins-section">
      <div class="bins-title">üóëÔ∏è Recycling Bins</div>
      <div class="bins-grid">
        <div class="bin green" id="bin-recyclable" ondrop="drop(event)" ondragover="allowDrop(event)">
          <div class="bin-icon">‚ôªÔ∏è</div>
          <div class="bin-label">Recyclable</div>
          <div class="bin-items">Paper, Plastic, Metal</div>
        </div>

        <div class="bin blue" id="bin-organic" ondrop="drop(event)" ondragover="allowDrop(event)">
          <div class="bin-icon">üçÉ</div>
          <div class="bin-label">Organic</div>
          <div class="bin-items">Food, Plants</div>
        </div>

        <div class="bin yellow" id="bin-hazardous" ondrop="drop(event)" ondragover="allowDrop(event)">
          <div class="bin-icon">‚ö†Ô∏è</div>
          <div class="bin-label">Hazardous</div>
          <div class="bin-items">Electronic, Battery</div>
        </div>
      </div>
    </div>

    <div class="buttons">
      <button class="btn btn-primary" onclick="submitGame()">Submit Game</button>
      <button class="btn btn-secondary" onclick="goBack()">Go Back</button>
    </div>
  </div>

  <div class="overlay" id="overlay"></div>
  <div class="result-modal" id="resultModal">
    <h2>Game Complete!</h2>
    <div class="result-score" id="finalScore">0</div>
    <div class="result-message" id="resultMessage"></div>
    <button class="btn btn-primary" onclick="closeResult()">Great Job!</button>
  </div>

  <script>
    const wasteItems = [
      { id: 1, name: 'Paper', icon: 'üì∞', category: 'recyclable' },
      { id: 2, name: 'Plastic Bottle', icon: 'üçæ', category: 'recyclable' },
      { id: 3, name: 'Apple Core', icon: 'üçé', category: 'organic' },
      { id: 4, name: 'Aluminum Can', icon: 'ü•´', category: 'recyclable' },
      { id: 5, name: 'Battery', icon: 'üîã', category: 'hazardous' },
      { id: 6, name: 'Banana Peel', icon: 'üçå', category: 'organic' }
    ];

    let score = 0;
    let correct = 0;
    let placed = {};

    function initGame() {
      const board = document.getElementById('wasteBoard');
      board.innerHTML = '';

      wasteItems.forEach(item => {
        const div = document.createElement('div');
        div.className = 'waste-item';
        div.draggable = true;
        div.id = 'item-' + item.id;
        div.innerHTML = `
          <div class="waste-icon">${item.icon}</div>
          <div class="waste-name">${item.name}</div>
        `;

        div.addEventListener('dragstart', function(e) {
          e.dataTransfer.effectAllowed = 'move';
          e.dataTransfer.setData('itemId', item.id);
          e.dataTransfer.setData('category', item.category);
        });

        board.appendChild(div);
        placed[item.id] = false;
      });

      updateStats();
    }

    function allowDrop(e) {
      e.preventDefault();
      e.dataTransfer.dropEffect = 'move';
    }

    function drop(e) {
      e.preventDefault();

      const itemId = parseInt(e.dataTransfer.getData('itemId'));
      const category = e.dataTransfer.getData('category');
      const binId = e.target.closest('.bin').id;
      const binCategory = binId.replace('bin-', '');

      const isCorrect = category === binCategory;

      if (isCorrect) {
        correct++;
        score += 25;
        placed[itemId] = true;

        const itemElement = document.getElementById('item-' + itemId);
        if (itemElement) {
          itemElement.style.opacity = '0.5';
          itemElement.style.pointerEvents = 'none';
        }
      } else {
        score = Math.max(0, score - 10);
      }

      updateStats();
    }

    function updateStats() {
      document.getElementById('score').textContent = score;
      document.getElementById('correct').textContent = correct;
      document.getElementById('itemsLeft').textContent = wasteItems.length - correct;
    }

    function submitGame() {
      const percentage = Math.round((correct / wasteItems.length) * 100);

      let message = '';
      if (percentage === 100) {
        message = 'üéâ Perfect! You sorted all waste correctly!';
      } else if (percentage >= 80) {
        message = 'üåü Great job! Keep learning!';
      } else if (percentage >= 60) {
        message = 'üëç Good effort! Practice more!';
      } else {
        message = 'üí™ Keep trying! You\'ll get better!';
      }

      const user = getCurrentUser();
      if (user) {
        addUserScore(user.email, 'eco-match', score, 'games', wasteItems.length);
      }

      document.getElementById('finalScore').textContent = score;
      document.getElementById('resultMessage').textContent = message;
      document.getElementById('resultModal').classList.add('show');
      document.getElementById('overlay').classList.add('show');
    }

    function closeResult() {
      goBack();
    }

    function goBack() {
      const user = getCurrentUser();
      if (user.level === 'school') {
        window.location.href = 'school-dashboard.html';
      } else {
        window.location.href = 'college-dashboard-new.html';
      }
    }

    document.addEventListener('DOMContentLoaded', function() {
      initializeStorage();
      initGame();
    });
  </script>
</body>
</html>
